# AI画图助手 - Chrome扩展

一个功能强大的Chrome浏览器插件，选中文字后右键菜单即可调用AI生成图片，支持改图功能和多种图片保存方式。

## 功能特性

### 🎨 图片生成
- **右键菜单画图** - 选中网页文字，右键点击"AI画图助手"即可生成图片
- **快捷键支持** - 使用 `Ctrl+Shift+D`（Mac: `Command+Shift+D`）快速画图
- **多服务商支持** - 支持OpenAI DALL-E、Stability AI、Replicate等主流AI画图服务
- **实时状态显示** - 页面右下角显示生成进度

### ✏️ 图片编辑（改图）
- **右键图片改图** - 右键点击网页图片，选择服务商进行编辑
- **本地上传改图** - 没有右键图片时，可上传本地图片进行编辑
- **灵活提示词** - 输入改图指令，如"将背景改为蓝色"、"添加一只猫"等

### 💾 图片保存与管理
- **复制到剪贴板** - 一键复制生成图片
- **下载到本地** - 保存图片到浏览器下载目录
- **分享到相册** - 配置图片上传服务后可分享到图床
- **历史记录** - 自动保存最近100条画图记录（可配置）
- **搜索历史** - 支持按提示词搜索历史记录
- **批量导出** - 勾选多张图片，一键导出为ZIP压缩包
- **批量删除** - 快速清理历史记录

### 🖼️ 查看与浏览
- **大图预览** - 点击历史记录中的图片查看大图
- **改图对比** - 改图操作显示原图与结果图对比
- **提示词查看** - 可展开查看完整的提示词内容
- **NSFW过滤** - 默认模糊敏感内容，可自由开关显示

### ⚙️ 高级配置
- **多API配置** - 支持配置多个画图/改图服务商
- **自定义API** - 可对接任意兼容的REST API
- **异步轮询** - 支持异步任务模式的API（如Replicate）
- **multipart上传** - 支持multipart/form-data格式的改图请求
- **模板管理** - 内置NewAPI等常用模板，支持自定义模板
- **自定义参数** - 支持配置请求参数、请求头、响应路径等

### 🔄 数据同步
- **WebDAV同步** - 支持将配置同步到WebDAV服务器
- **加密导出** - 配置支持AES-GCM加密导出，保护API密钥安全
- **配置导入** - 支持导入加密或明文配置文件

### 🐛 调试功能
- **API调试** - 生成失败时可查看完整的请求/响应数据
- **错误详情** - 显示详细的错误信息便于排查问题

## 安装方法

1. 打开Chrome浏览器，访问 `chrome://extensions/`
2. 开启右上角的"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择本插件的文件夹 `chrome-aidrawer`
5. 安装成功后，插件图标会出现在工具栏

## 使用说明

### 基础画图

1. 在网页上选中要生成图片的文字
2. 右键点击选中的文字，选择"AI画图助手" → "根据选中内容生成图片"
3. 等待AI生成图片
4. 生成完成后，可以预览、复制或下载图片

### 改图功能

**方式一：右键图片改图**
1. 在网页上右键点击图片
2. 选择"✏️ 用 [服务商名] 改图"
3. 输入改图提示词
4. 点击"开始改图"

**方式二：上传本地图片改图**
1. 右键选中文字或页面空白处
2. 选择"✏️ 用 [服务商名] 改图"
3. 在弹出的对话框中点击"选择图片"上传本地图片
4. 输入改图提示词
5. 点击"开始改图"

### 配置图片上传服务

配置图片上传服务可解决以下场景：
- 分享图片到图床
- 服务端无法下载图片URL时

配置步骤：
1. 打开扩展设置页面
2. 找到"图片上传服务"部分
3. 点击"添加上传服务"
4. 配置上传服务端点、认证方式、响应路径等
5. 点击"测试连接"验证配置
6. 保存后即可使用

### 配置API

1. 点击插件图标，选择"API设置"
2. 添加AI服务商（支持画图和改图两种类型）
3. 输入API密钥和端点URL
4. 配置请求参数和请求头（可选）
5. 点击"保存设置"
6. 点击"测试连接"验证配置

### 快捷键

- **Windows/Linux**: `Ctrl+Shift+D`
- **Mac**: `Command+Shift+D`

可在Chrome扩展快捷键设置页面修改快捷键。

## 文件结构

```
chrome-aidrawer/
├── manifest.json          # 插件配置
├── background.js          # 后台脚本（处理API请求、管理历史记录）
├── content.js             # 内容脚本（处理页面交互、显示结果）
├── popup.html             # 弹窗页面
├── popup.js               # 弹窗逻辑
├── options.html           # API配置页面
├── options.js             # 配置逻辑（服务商管理、模板、WebDAV等）
├── history.html           # 历史记录页面
├── history.js             # 历史记录逻辑
├── edit-dialog.html       # 改图对话框页面
├── edit-dialog.js         # 改图对话框逻辑
├── icons/                 # 插件图标
├── styles/                # 样式文件
│   ├── common.css         # 公共样式
│   ├── popup.css          # 弹窗样式
│   ├── options.css        # 设置页面样式
│   ├── history.css        # 历史记录样式
│   └── edit-dialog.css    # 改图对话框样式
└── lib/                   # 共享库
    ├── common.js          # 公共工具函数（ES6模块）
    ├── image-utils.js     # 图片处理工具（ES6模块）
    └── jszip.min.js       # ZIP压缩库（第三方）
```

## 支持的API

### 画图服务
- OpenAI DALL-E 2/3
- Stability AI (Stable Diffusion)
- Replicate (开源模型如SDXL、FLUX)
- NewAPI 等聚合平台
- 其他兼容的REST API

### 改图服务
- OpenAI DALL-E Edit
- Stability AI Image-to-Image
- Replicate Edit API
- 自定义改图API
- 支持异步轮询模式

### 图片上传服务
- 通用文件上传API
- 图床服务（如SM.MS、ImgBB等）
- 云存储服务
- 自建上传服务

## 注意事项

1. **API密钥安全**
   - 建议定期导出加密备份配置
   - 不要将API密钥分享给他人

2. **使用费用**
   - 使用AI服务可能产生费用，请留意服务商计费方式
   - 部分API可能需要代理才能访问

3. **功能限制**
   - 改图功能需要配置支持图片编辑的API
   - 图片上传服务需要支持跨域请求（CORS）
   - 历史记录存储有Chrome扩展配额限制（超出时需清理）

4. **调试**
   - 生成失败时可点击"调试"查看请求/响应详情
   - 建议先测试API连接再正式使用

## 更新日志

### v2.0.0
- ✨ 新增改图功能，支持编辑现有图片
- 🔧 新增图片上传服务配置
- ✨ 新增WebDAV配置同步功能
- ✨ 新增配置加密导出功能
- ✨ 新增API模板管理功能
- ✨ 新增历史记录批量导出为ZIP
- ✨ 新增NSFW内容过滤功能
- ✨ 新增搜索历史功能
- 🎨 优化用户界面，支持文件选择和上传
- 🎨 优化图片预览和提示词显示
- 🐛 修复多项已知问题

### v1.0.0
- 🎉 基础画图功能
- ⚙️ 多API支持
- 📚 历史记录功能

---

**English version available at [README_EN.md](README_EN.md)**
